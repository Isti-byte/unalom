<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pong Game</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Main Menu -->
  <div id="menuScreen" class="screen active">
    <div class="menu-container">
      <h1 id="titleClick" onclick="titleClicked()" style="cursor: pointer;">PONG</h1>
      <div class="menu-buttons">
        <button class="btn" onclick="startGame(1)">1 PLAYER</button>
        <button class="btn" onclick="startGame(2)">2 PLAYERS</button>
        <button class="btn" onclick="enterTestMode()" id="ownerBtn" style="display: none; background-color: #ffaa00;">ðŸ‘‘ OWNER MODE</button>
      </div>
    </div>
  </div>

  <!-- Difficulty Selection Screen -->
  <div id="difficultyScreen" class="screen">
    <div class="menu-container">
      <h1>SELECT DIFFICULTY</h1>
      <div class="menu-buttons">
        <button class="btn" onclick="startGameWithDifficulty('easy')">EASY</button>
        <button class="btn" onclick="startGameWithDifficulty('medium')">MEDIUM</button>
        <button class="btn" onclick="startGameWithDifficulty('hard')">HARD</button>
        <button class="btn" onclick="goToMenu()">BACK</button>
      </div>
    </div>
  </div>

  <!-- Test Mode Screen -->
  <div id="testScreen" class="screen">
    <div class="menu-container">
      <h1>TEST MODE</h1>
      <div class="test-container">
        <div class="test-section">
          <h3>Ball Speed Control</h3>
          <div class="test-controls">
            <label>Speed: <input type="range" id="ballSpeedSlider" min="1" max="10" value="3" onchange="testBallSpeed()"></label>
            <p id="ballSpeedDisplay">Current: 3</p>
          </div>
        </div>
        
        <div class="test-section">
          <h3>AI Difficulty</h3>
          <div class="test-controls">
            <button class="test-btn" onclick="testAIDifficulty('easy')">EASY</button>
            <button class="test-btn" onclick="testAIDifficulty('medium')">MEDIUM</button>
            <button class="test-btn" onclick="testAIDifficulty('hard')">HARD</button>
            <p id="aiDiffDisplay">Current: medium</p>
          </div>
        </div>
        
        <div class="test-section">
          <h3>Paddle Size</h3>
          <div class="test-controls">
            <label>Height: <input type="range" id="paddleSizeSlider" min="20" max="120" value="60" onchange="testPaddleSize()"></label>
            <p id="paddleSizeDisplay">Current: 60px</p>
          </div>
        </div>
        
        <div class="test-section">
          <h3>Canvas Size</h3>
          <div class="test-controls">
            <button class="test-btn" onclick="testCanvasSize(600, 300)">SMALL</button>
            <button class="test-btn" onclick="testCanvasSize(800, 400)">MEDIUM</button>
            <button class="test-btn" onclick="testCanvasSize(1000, 500)">LARGE</button>
            <p id="canvasSizeDisplay">Current: 800x400</p>
          </div>
        </div>
        
        <div class="test-section">
          <h3>Game Stats</h3>
          <div class="test-controls">
            <button class="test-btn" onclick="testResetScores()">RESET SCORES</button>
            <button class="test-btn" onclick="testSetScore()">SET CUSTOM SCORE</button>
            <p id="statsDisplay">P1: 0 | P2: 0</p>
          </div>
        </div>
      </div>
      <div class="menu-buttons">
        <button class="btn" onclick="goToMenu()">EXIT TEST MODE</button>
      </div>
    </div>
  </div>

  <!-- Game Screen -->
  <div id="gameScreen" class="screen">
    <div class="game-wrapper">
      <div class="player-info left">
        <h3>Player 1</h3>
        <p class="score" id="score1">0</p>
      </div>
      <div class="canvas-container">
        <canvas id="gameCanvas" width="800" height="400"></canvas>
        <!-- Mobile touch controls -->
        <div class="mobile-controls" id="mobileControls" style="display:none;">
          <div class="touch-zone left-zone" id="leftUp" ontouchstart="handleMobileControl('p1Up', true)" ontouchend="handleMobileControl('p1Up', false)">â†‘</div>
          <div class="touch-zone right-zone" id="rightUp" ontouchstart="handleMobileControl('p2Up', true)" ontouchend="handleMobileControl('p2Up', false)">â†‘</div>
          <div class="touch-zone left-zone bottom" id="leftDown" ontouchstart="handleMobileControl('p1Down', true)" ontouchend="handleMobileControl('p1Down', false)">â†“</div>
          <div class="touch-zone right-zone bottom" id="rightDown" ontouchstart="handleMobileControl('p2Down', true)" ontouchend="handleMobileControl('p2Down', false)">â†“</div>
        </div>
      </div>
      <div class="player-info right">
        <h3>Player 2</h3>
        <p class="score" id="score2">0</p>
      </div>
    </div>
    <div class="game-controls">
      <div class="controls-text">
        <p id="p1ControlText"><strong>Player 1:</strong> W / S keys</p>
        <p id="p2Text"><strong>Player 2:</strong> â†‘ / â†“ keys</p>
      </div>
      <button class="btn" onclick="pauseGame()">PAUSE</button>
      <button class="btn" onclick="goToMenu()">MENU</button>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // Game Variables
    let gameMode = 2; // 1 or 2 players
    let difficulty = 'medium'; // easy, medium, hard
    let isPaused = false;
    let gameRunning = true;
    let isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    
    // Test mode variables
    let testModeActive = false;
    let testMode_ballSpeed = 3;
    let titleClickCount = 0;
    let titleClickTimer = null;
    let mobileKeys = {
      p1Up: false,
      p1Down: false,
      p2Up: false,
      p2Down: false
    };

    // Paddle Class
    class Paddle {
      constructor(x, y) {
        this.x = x;
        this.y = y;
        this.width = 10;
        this.height = 60;
        this.speed = 4;
        this.dy = 0;
        this.score = 0;
      }

      update() {
        this.y += this.dy;
        if (this.y < 0) this.y = 0;
        if (this.y + this.height > canvas.height) this.y = canvas.height - this.height;
      }

      draw() {
        ctx.fillStyle = '#fff';
        ctx.fillRect(this.x, this.y, this.width, this.height);
      }

      reset() {
        this.y = canvas.height / 2 - this.height / 2;
        this.dy = 0;
      }
    }

    // Ball Class
    class Ball {
      constructor() {
        this.x = canvas.width / 2;
        this.y = canvas.height / 2;
        this.radius = 5;
        this.speedX = 3;
        this.speedY = 3;
      }

      update() {
        this.x += this.speedX;
        this.y += this.speedY;

        // Bounce off top and bottom
        if (this.y - this.radius < 0 || this.y + this.radius > canvas.height) {
          this.speedY = -this.speedY;
        }

        // Bounce off paddles
        this.checkPaddleCollision(player1);
        this.checkPaddleCollision(player2);

        // Score points
        if (this.x - this.radius < 0) {
          player2.score++;
          this.reset();
        } else if (this.x + this.radius > canvas.width) {
          player1.score++;
          this.reset();
        }

        updateScores();
      }

      checkPaddleCollision(paddle) {
        // Check if ball is within paddle's x range
        let ballLeft = this.x - this.radius;
        let ballRight = this.x + this.radius;
        let ballTop = this.y - this.radius;
        let ballBottom = this.y + this.radius;
        
        let paddleLeft = paddle.x;
        let paddleRight = paddle.x + paddle.width;
        let paddleTop = paddle.y;
        let paddleBottom = paddle.y + paddle.height;

        // Check for collision
        if (ballLeft < paddleRight && ballRight > paddleLeft &&
            ballTop < paddleBottom && ballBottom > paddleTop) {
          
          // Determine which side of paddle was hit
          let overlapLeft = ballRight - paddleLeft;
          let overlapRight = paddleRight - ballLeft;
          let overlapTop = ballBottom - paddleTop;
          let overlapBottom = paddleBottom - ballTop;

          // Find minimum overlap
          let minOverlap = Math.min(overlapLeft, overlapRight, overlapTop, overlapBottom);

          if (minOverlap === overlapLeft || minOverlap === overlapRight) {
            // Hit from left or right side
            this.speedX = -this.speedX;
            this.speedY += paddle.dy * 0.15;
            
            // Push ball out of paddle
            if (paddle === player1) {
              this.x = paddleRight + this.radius;
            } else {
              this.x = paddleLeft - this.radius;
            }
          } else {
            // Hit from top or bottom
            this.speedY = -this.speedY;
            this.speedX += paddle.dy * 0.15;
            
            if (minOverlap === overlapTop) {
              this.y = paddleTop - this.radius;
            } else {
              this.y = paddleBottom + this.radius;
            }
          }
        }
      }

      draw() {
        ctx.fillStyle = '#fff';
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fill();
      }

      reset() {
        this.x = canvas.width / 2;
        this.y = canvas.height / 2;
        this.speedX = 3;
        this.speedY = 3;
      }
    }

    // Create game objects
    const player1 = new Paddle(10, canvas.height / 2 - 30);
    const player2 = new Paddle(canvas.width - 20, canvas.height / 2 - 30);
    const ball = new Ball();

    // Keyboard input
    const keys = {};
    document.addEventListener('keydown', (e) => {
      keys[e.key.toLowerCase()] = true;
      
      // Test mode access (Ctrl+Shift+T)
      if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 't') {
        enterTestMode();
        return;
      }
      
      if (keys['w']) player1.dy = -player1.speed;
      if (keys['s']) player1.dy = player1.speed;
      if (keys['arrowup']) player2.dy = -player2.speed;
      if (keys['arrowdown']) player2.dy = player2.speed;
    });

    document.addEventListener('keyup', (e) => {
      keys[e.key.toLowerCase()] = false;
      if (!keys['w'] && !keys['s']) player1.dy = 0;
      if (!keys['arrowup'] && !keys['arrowdown']) player2.dy = 0;
    });

    // Mobile control handler
    function handleMobileControl(control, isPressed) {
      mobileKeys[control] = isPressed;
      
      if (mobileKeys.p1Up) player1.dy = -player1.speed;
      else if (mobileKeys.p1Down) player1.dy = player1.speed;
      else player1.dy = 0;
      
      if (mobileKeys.p2Up) player2.dy = -player2.speed;
      else if (mobileKeys.p2Down) player2.dy = player2.speed;
      else if (gameMode === 2) player2.dy = 0;
    }

    // AI for single player
    function updateAI() {
      const paddle = player2;
      const dy = ball.y - (paddle.y + paddle.height / 2);
      
      let speed = paddle.speed;
      let threshold = 35;
      
      // Adjust AI difficulty
      if (difficulty === 'easy') {
        speed = 2; // Slower
        threshold = 50; // Less responsive
      } else if (difficulty === 'medium') {
        speed = 4; // Normal
        threshold = 35;
      } else if (difficulty === 'hard') {
        speed = 6; // Faster
        threshold = 20; // More responsive
      }
      
      if (dy < -threshold) {
        paddle.dy = -speed;
      } else if (dy > threshold) {
        paddle.dy = speed;
      } else {
        paddle.dy = 0;
      }
    }

    // Draw center line
    function drawLine() {
      ctx.strokeStyle = '#fff';
      ctx.setLineDash([5, 5]);
      ctx.beginPath();
      ctx.moveTo(canvas.width / 2, 0);
      ctx.lineTo(canvas.width / 2, canvas.height);
      ctx.stroke();
      ctx.setLineDash([]);
    }

    // Update scores
    function updateScores() {
      document.getElementById('score1').textContent = player1.score;
      document.getElementById('score2').textContent = player2.score;
    }

    // Game loop
    function gameLoop() {
      if (!isPaused && gameRunning) {
        // Update
        player1.update();
        if (gameMode === 2) {
          player2.update();
        } else {
          updateAI();
          player2.update();
        }
        ball.update();

        // Draw
        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        drawLine();
        player1.draw();
        player2.draw();
        ball.draw();
      }
      requestAnimationFrame(gameLoop);
    }

    // Menu functions
    function startGame(players) {
      if (players === 1) {
        // Show difficulty selection for single player
        document.getElementById('menuScreen').classList.remove('active');
        document.getElementById('difficultyScreen').classList.add('active');
      } else {
        // Start 2 player game directly
        gameMode = 2;
        gameRunning = true;
        isPaused = false;
        player1.score = 0;
        player2.score = 0;
        player1.reset();
        player2.reset();
        ball.reset();
        
        const p2Text = document.getElementById('p2Text');
        const p1ControlText = document.getElementById('p1ControlText');
        const mobileControls = document.getElementById('mobileControls');
        
        if (isMobile) {
          p1ControlText.innerHTML = '<strong>Player 1:</strong> Touch Left Side';
          p2Text.innerHTML = '<strong>Player 2:</strong> Touch Right Side';
          p2Text.style.display = 'block';
          mobileControls.style.display = 'block';
        } else {
          p1ControlText.innerHTML = '<strong>Player 1:</strong> W / S keys';
          p2Text.innerHTML = '<strong>Player 2:</strong> â†‘ / â†“ keys';
          p2Text.style.display = 'block';
          mobileControls.style.display = 'none';
        }
        
        document.getElementById('menuScreen').classList.remove('active');
        document.getElementById('gameScreen').classList.add('active');
        updateScores();
      }
    }

    function startGameWithDifficulty(diff) {
      difficulty = diff;
      gameMode = 1;
      gameRunning = true;
      isPaused = false;
      player1.score = 0;
      player2.score = 0;
      player1.reset();
      player2.reset();
      ball.reset();
      
      const p2Text = document.getElementById('p2Text');
      const p1ControlText = document.getElementById('p1ControlText');
      const mobileControls = document.getElementById('mobileControls');
      
      if (isMobile) {
        p1ControlText.innerHTML = '<strong>Player 1:</strong> Touch Controls';
        p2Text.style.display = 'none';
        mobileControls.style.display = 'block';
      } else {
        p2Text.style.display = 'none';
        mobileControls.style.display = 'none';
      }
      
      document.getElementById('difficultyScreen').classList.remove('active');
      document.getElementById('gameScreen').classList.add('active');
      updateScores();
    }

    function pauseGame() {
      isPaused = !isPaused;
      const btn = event.target;
      btn.textContent = isPaused ? 'RESUME' : 'PAUSE';
    }

    // Owner Button Logic
    function titleClicked() {
      titleClickCount++;
      
      // Reset timer on new click
      clearTimeout(titleClickTimer);
      
      if (titleClickCount === 7) {
        // Reveal owner button
        document.getElementById('ownerBtn').style.display = 'block';
        titleClickCount = 0;
      }
      
      // Reset count after 2 seconds of no clicks
      titleClickTimer = setTimeout(() => {
        titleClickCount = 0;
      }, 2000);
    }

    // Test Mode Functions
    function enterTestMode() {
      testModeActive = true;
      document.getElementById('menuScreen').classList.remove('active');
      document.getElementById('testScreen').classList.add('active');
      updateTestDisplay();
    }

    function testBallSpeed() {
      const slider = document.getElementById('ballSpeedSlider');
      testMode_ballSpeed = parseInt(slider.value);
      ball.speedX = testMode_ballSpeed;
      ball.speedY = testMode_ballSpeed;
      document.getElementById('ballSpeedDisplay').textContent = 'Current: ' + testMode_ballSpeed;
    }

    function testAIDifficulty(diff) {
      difficulty = diff;
      document.getElementById('aiDiffDisplay').textContent = 'Current: ' + diff;
    }

    function testPaddleSize() {
      const slider = document.getElementById('paddleSizeSlider');
      const newSize = parseInt(slider.value);
      player1.height = newSize;
      player2.height = newSize;
      document.getElementById('paddleSizeDisplay').textContent = 'Current: ' + newSize + 'px';
    }

    function testCanvasSize(width, height) {
      canvas.width = width;
      canvas.height = height;
      document.getElementById('canvasSizeDisplay').textContent = 'Current: ' + width + 'x' + height;
    }

    function testResetScores() {
      player1.score = 0;
      player2.score = 0;
      document.getElementById('statsDisplay').textContent = 'P1: 0 | P2: 0';
      updateScores();
    }

    function testSetScore() {
      const p1Score = prompt('Enter Player 1 score:', player1.score);
      if (p1Score !== null) {
        player1.score = parseInt(p1Score) || 0;
      }
      const p2Score = prompt('Enter Player 2 score:', player2.score);
      if (p2Score !== null) {
        player2.score = parseInt(p2Score) || 0;
      }
      document.getElementById('statsDisplay').textContent = 'P1: ' + player1.score + ' | P2: ' + player2.score;
      updateScores();
    }

    function updateTestDisplay() {
      document.getElementById('ballSpeedDisplay').textContent = 'Current: ' + testMode_ballSpeed;
      document.getElementById('aiDiffDisplay').textContent = 'Current: ' + difficulty;
      document.getElementById('paddleSizeDisplay').textContent = 'Current: ' + player1.height + 'px';
      document.getElementById('canvasSizeDisplay').textContent = 'Current: ' + canvas.width + 'x' + canvas.height;
      document.getElementById('statsDisplay').textContent = 'P1: ' + player1.score + ' | P2: ' + player2.score;
    }

    function goToMenu() {
      gameRunning = false;
      isPaused = false;
      testModeActive = false;
      document.getElementById('gameScreen').classList.remove('active');
      document.getElementById('difficultyScreen').classList.remove('active');
      document.getElementById('testScreen').classList.remove('active');
      document.getElementById('menuScreen').classList.add('active');
      const btn = document.querySelector('[onclick="pauseGame()"]');
      if (btn) btn.textContent = 'PAUSE';
    }

    // Start game loop
    gameLoop();
  </script>
</body>
</html>